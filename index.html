<!DOCTYPE html>
<html>
	<head>
		<title>Page Title</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

		<link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" rel="stylesheet">
		<link href="style.css" rel="stylesheet">
	</head>
	<body>

		<style id="dynamic-style"></style>

		<div class="grid"></div>

		<script type="text/javascript">
			var buildings = {
				// Resources
				asdf: { name: 'Construction Shop', width: 0, height: 0 },
				asdf: { name: 'Titanium Mine', width: 0, height: 0 },
				asdf: { name: 'Titanium Storage', width: 0, height: 0 },
				asdf: { name: 'Helium-3 Separator', width: 0, height: 0 },
				asdf: { name: 'Helium-3 Storage', width: 0, height: 0 },
				// Army
				asdf: { name: 'Military Plant', width: 0, height: 0 },
				asdf: { name: 'Training Camp', width: 0, height: 0 },
				asdf: { name: 'Nanobot Factory', width: 0, height: 0 },
				asdf: { name: 'Science Lab', width: 0, height: 0 },
				asdf: { name: 'Hero\'s Outpost', width: 0, height: 0 },
				// Defense
				asdf: { name: 'Gauss Cannon', width: 0, height: 0 },
				asdf: { name: 'Plasma Gun', width: 0, height: 0 },
				asdf: { name: 'Missile Launcher', width: 0, height: 0 },
				asdf: { name: 'Laser Turret', width: 0, height: 0 },
				asdf: { name: 'Proton Emitter', width: 0, height: 0 },
				asdf: { name: 'Land Mine', width: 0, height: 0 },
				asdf: { name: 'Force Field', width: 0, height: 0 },
				asdf: { name: 'Annihilator', width: 0, height: 0 },
				asdf: { name: 'Missile Pit', width: 0, height: 0 },
				asdf: { name: 'Radioactive Trap', width: 0, height: 0 },
				asdf: { name: 'Gravity Trap', width: 0, height: 0 },
				asdf: { name: 'Pulse Tower', width: 0, height: 0 },
				asdf: { name: 'Wall', width: 0, height: 0 },
			};

			var items = [
				{ name: 'weapon', width: 3, height: 3, count: 4 },
				{ name: 'outpost', width: 5, height: 5, count: 3 },
				{ name: 'wall', width: 1, height: 1, count: 75 },
			];

			var grid = null;
			var gridSize = 20;

			$(function () {

				addItems();

				// initialize drag/drop and snap-to-grid
				$(".building")
					.draggable({
						grid: [gridSize, gridSize],
						addClasses: false,
						// cursor: "crosshair",
						opacity: 0.7,
						stop: function(event, ui) {
							console.log(ui.position);
						},
					})
					// .on("dragstop", function() {
					// 	console.log(ui.position);
					// })
					.on("mouseover", function() {
						$(this).addClass("move-cursor");
					})
					.on("mousedown", function() {
						$(this)
							.removeClass("move-cursor")
							.addClass("grab-cursor")
							.addClass("opac");
					})
					.on("mouseup", function() {
						$(this)
							.removeClass("grab-cursor")
							.removeClass("opac")
							.addClass("move-cursor");
					});

			});

			function addItems() {
				var elements = [];

				for (var item of items) {
					for (var idx in _.range(item.count)) {
						elements.push(addItem(item));
					}
				}

				// return ret;
				$(".grid").append(elements);
			}

			function addItem(item) {
				var classes = `building h${item.height} w${item.width} ${item.name}`;
				var template = `
					<div class="${classes}">
						<div class="text">
							${item.name}
						</div>
					</div>`;

				return $(template);
			}
		</script>

	</body>
</html>
